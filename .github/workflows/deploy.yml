name: Deploy to Amazon ECS

on: [push]
#  release:
#    types: [ created ]

env:
  AWS_REGION: us-east-1                   # set this to your preferred AWS region, e.g. us-west-1
  ECR_REPOSITORY: talan-bookadesk           # set this to your Amazon ECR repository name
defaults:
  run:
    shell: bash

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    permissions:
      packages: write
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Docker Login
        # You may pin to the exact commit or the version.
        # uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
        uses: docker/login-action@v1.10.0
        with:
          # Username used to log against the Docker registry
          username: talanlabsopen
          # Password or personal access token used to log against the Docker registry
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build, tag, and push image to Docker Hub
        id: deploy-docker-hub
        run: |
          docker build --build-arg current_version="${{ github.event.release.tag_name }}" -t talanlabsopen/talan-bookadesk:latest .
          docker push talanlabsopen/talan-bookadesk:latest
